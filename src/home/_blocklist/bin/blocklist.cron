#!/bin/sh
set -e

##
# Environment
export HOME="/home/_blocklist"
export PATH="/usr/bin:/usr/local/bin:${PATH}"
. /home/_blocklist/functions/date.sh

##
# Variables
blocklist=$(which blocklist)
doas=$(which doas)
path="/home/_blocklist/blocklists/$(today)"

##
# Download blocklist
${blocklist} download
${blocklist} echo > ${path}

##
# Reload PF
${doas} -u root /home/_blocklist/libexec/blocklist/blocklist-copy
${doas} -u root /home/_blocklist/libexec/blocklist/blocklist-reload
